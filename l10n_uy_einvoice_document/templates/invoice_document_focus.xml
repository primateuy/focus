<?xml version="1.0" encoding="utf-8"?>

<odoo>
    <data>
        <template id="report_l10nuy_einvoice_document">
                <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)" />

                <!--CABEZAL DE LA FACTURA-->
                <div name="cabezal" style="position:relative;display:flex;" class="container">
                    <div style="flex: 1; text-align: left;flex-direction:column;font-size:15px;">
                        <!--LOGO DE LA EMPRESAEMPRESA-->
                        <tr>
                            <td>
                                <t t-set="company_img" t-value="doc.company_id"/>
                                <img t-if="company_img.logo" t-att-src="image_data_uri(company_img.logo)"  alt="Logo" style="width: 150px; height: 150px;" />
                                <br/><strong><t t-esc="doc.company_id.name"/></strong>
                            </td>
                        </tr>

                        <!--INFORMACIÓN SOBRE LA COMPAÑIA-->
                        <tr>
                            <td>
                                <t t-esc="doc.company_id.city"/><br/>
                                <t t-esc="doc.company_id.street"/><br/>
                                <t t-esc="doc.company_id.state_id.name"/><br/>
                                <t t-esc="doc.company_id.zip"/>
                            </td>
                        </tr>

                    </div>
                    <!--TABLAS CABEZAL DERECHO-->
                    <div style="flex: 1; text-align: right;position:absolute;top:0;right:0;margin:0px 5px 0px 0px;width:75%;" name="cabezal_derecho">
                        <table style="width:100%;margin-bottom:10px;text-align: center;border-collapse:separate;" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-left-radius: 25px;border-bottom-left-radius: 25px;">RUT</td>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold; vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Tipo de comprobante</td>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold; vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-right-radius: 25px;border-bottom-right-radius: 25px;">Número</td>

                            </tr>
                            <tr>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.company_id.vat"/>
                                </td>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.l10n_latam_document_type_id.name"/>
                                </td>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.cfe_serie_num"/>
                                </td>
                            </tr>
                        </table>
                        <table style="width:100%;margin-bottom:10px;text-align: center;border-collapse:separate;" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-left-radius: 25px;border-bottom-left-radius: 25px;">Fecha Emisión</td>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Vencimiento</td>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Moneda</td>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-right-radius: 25px;border-bottom-right-radius: 25px;">Forma de Pago</td>
                            </tr>
                            <tr>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.invoice_date.strftime('%d.%m.%Y')"/>
                                </td>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.invoice_date_due.strftime('%d.%m.%Y')"/>
                                </td>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.currency_id.name"/>
                                </td>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.name"/>
                                </td>
                            </tr>
                        </table>
                        <table style="width:100%;margin-bottom:10px;text-align: center;border-collapse:separate;" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-left-radius: 25px;border-bottom-left-radius: 25px;">RUT Comprador</td>
                                <td t-attf-style="font-size:15px;padding: 5px 10px 5px 10px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-right-radius: 25px;border-bottom-right-radius: 25px;">Datos Comprador</td>
                            </tr>
                            <tr>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <t t-esc="doc.partner_id.vat"/>
                                </td>
                                <td style="font-size:15px;padding: 5px 10px 5px 10px;vertical-align:middle;">
                                    <strong><t style="font-size:15px;" t-esc="doc.partner_id.name"/><br/></strong>
                                    <span><t t-esc="doc.partner_id.city"/>-</span>
                                    <span><t t-esc="doc.partner_id.street"/>-</span>
                                    <span><t t-esc="doc.partner_id.state_id.name"/>-</span>
                                    <t t-esc="doc.partner_id.zip"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!--TABLA DE LAS FACTURAS-->
                <div name="lineas_de_factura" style="position:relative;">
                    <table style="width:100%;margin-top:10%;margin-bottom: 50px;border-collapse:separate;" border="0" cellspacing="0" cellpadding="0">
                        <!--                        table table-sm mt16 mb32 -->
                        <thead>
                            <tr>
                                <th t-attf-style="background-color: {{doc.company_id.background_color or '#FF8F8F'}};width:50%;text-align:left;font-size:15px;padding: 0px 0px 0px 50px;font-weight:bold;vertical-align:middle;border-top-left-radius: 25px;border-bottom-left-radius: 25px;">Descripción</th>
                                <th t-attf-style="text-align:left;font-size:15px;padding: 0 25px 0 25px;font-weight:bold; vertical-align:middle;  background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Cantidad</th>
                                <th t-attf-style="text-align: left;font-size:15px;padding: 5px 10px 5px 25px;font-weight:bold;vertical-align:middle;  background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Precio unitario</th>
                                <th t-attf-style="text-align: left;font-size:15px;padding: 0 25px 0 25px;font-weight:bold;vertical-align:middle;  background-color: {{doc.company_id.background_color or '#FF8F8F'}};" groups="sale.group_discount_per_so_line">Descuento</th>
                                <th t-attf-style="text-align: left;font-size:15px;padding: 0 25px 0 25px;font-weight:bold;vertical-align:middle;  background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Impuestos</th>
                                <th t-attf-style="text-align: left;font-size:15px;padding: 0 25px 0 25px;font-weight:bold;vertical-align:middle;  background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Codigo</th>
                                <th t-attf-style="text-align: left;font-size:15px;padding: 0 25px 0 25px;font-weight:bold;vertical-align:middle;  background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-right-radius: 25px;border-bottom-right-radius: 25px;">Importe</th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody">
                            <tr t-foreach="doc.invoice_line_ids" t-as="l" >
                                <td style="padding-left:25px;" class="text-left"><span t-field="l.name"/></td>
                                <td class="text-center">
                                    <span t-field="l.quantity"/>
                                    <span t-field="l.uos_id"  groups="product.group_uom"/>
                                </td>
                                <td class="text-center">
                                    <span t-field="l.price_unit"/>
                                </td>
                                <td class="text-center" groups="sale.group_discount_per_so_line"><span t-field="l.discount"/></td>
                                <td class="text-center"><span t-esc="', '.join(map(lambda x: x.name, l.tax_ids))"/></td>
                                <td class="text-center">
                                    <t t-set="indicator_codes" t-value="','.join(str(tax.invoicing_indicator_id.code) for tax in l.tax_ids if tax.invoicing_indicator_id)"/>
                                    <span t-esc="indicator_codes"/>
                                </td>
                                <td class="text-center"><span t-field="l.price_subtotal"/></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- TABLA QUE MUESTRA LOS SUBTOTALES-->
                <div name="subtotal" style="page-break-after: auto;">
                    <div style="float: right;">
                        <table style="border-collapse:separate;" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <t t-foreach="doc.tax_totals.get('subtotals')" t-as="subtotal">
                                    <tr>
                                        <td style="text-align:left;font-size:20px;padding-right: 40px;">Total sin impuestos</td>

                                        <td class="text-end" style="text-align:right;font-size:16px;">
                                            <span
                                                    t-att-class="oe_subtotal_footer_separator"
                                                    t-out="subtotal['formatted_amount']"
                                            >27.00</span>
                                        </td>
                                    </tr>

                                    <t t-set="subtotal_to_show" t-value="subtotal['name']"/>
                                    <t t-foreach="doc.tax_totals['groups_by_subtotal'][subtotal_to_show]" t-as="amount_by_group">
                                        <t t-set="display_tax_base" t-value="doc.tax_totals['display_tax_base']"/>
                                        <tr>
                                            <t t-if="doc.tax_totals['display_tax_base']">
                                                <td>
                                                    <span t-esc="amount_by_group['tax_group_name']"/>
                                                </td>
                                                <td class="text-end o_price_total">
                                                    <span class="text-nowrap" t-out="amount_by_group['formatted_tax_group_amount']"></span>
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td>
                                                    <span t-out="amount_by_group['tax_group_name']"></span>

                                                </td>
                                                <td class="text-end o_price_total">
                                                    <span class="text-nowrap" t-out="amount_by_group['formatted_tax_group_amount']"></span>
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
                                </t>

                            </tr>
                            <tr>
                                <td t-attf-style="text-align:left;font-size:20px;font-weight:bold;background-color: {{doc.company_id.background_color or '#FF8F8F'}};padding: 5px 10px 5px 10px;border-top-left-radius: 25px;border-bottom-left-radius: 25px;">Total a Pagar</td>
                                <td t-attf-style="text-align:right;font-size:20px;font-weight:bold;background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-top-right-radius: 25px;border-bottom-right-radius: 25px;padding: 5px 10px 5px 10px;">
                                    <span t-field="doc.amount_total" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!--TABLA CON EL QR CODE-->
                <div name="qr_code" style="margin: auto 0px 30px 0px;page-break-after: auto;">
                    <div style="width: 100%;flex: 1;">
                        <table style="font-size:15px;border-collapse:separate;" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td style="vertical-align: top;height: 200px;">

                                    <img t-if="doc.cfe_url_qr" t-att-src="image_data_uri(doc.cfe_url_qr)"  alt="QR" style="min-width: 150px;min-width: 150px; max-width: 200px; max-height: 200px;"/>
                                </td>
                                <td style="vertical-align: top;height: 200px;">
                                    <br/><br/>
                                    <span>Puede verificar comprobante en efactura.dgi.gub.uy</span><br/>
                                    <span>I.V.A al dia</span><br/>
                                    <span>CAE: <t  t-esc="doc.cfe_numero_cae"/></span><br/>
                                    <span>Serie: <t  t-esc="doc.cfe_serie"/></span><br/>
                                    <span>Rango: <t t-esc="doc.cfe_cae_from"/> al <t style="font-size:12px;" t-esc="doc.cfe_cae_to"/></span><br/>
                                    <span t-attf-style="font-weight:bold;background-color: {{doc.company_id.background_color or '#FF8F8F'}};">Fecha Vencimiento: <t t-esc="doc.cfe_cae_exp_date"/></span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div style="text-align: center;page-break-after: always;">
                    <table style="width:100%;border-collapse:separate;" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td t-attf-style="text-align: center;font-size:20px;font-weight:bold;vertical-align:middle; background-color: {{doc.company_id.background_color or '#FF8F8F'}};border-bottom-right-radius: 25px; border-radius: 25px;">Adenda</td>
                        </tr>
                        <tr>
                            <td style="text-align: center;">
                                <br/><br/><br/><br/><br/><span style="text-align: center;font-size:13px;">* 1. No gravado 2. Tasa mínima 3. Tasa básica 4. Otra tasa 5. Entrega gratuita 6. No facturable 10. Exportación y Asimiladas 11. Imp.percibido 12.IVA en suspenso</span><br/>
                            </td>
                        </tr>

                    </table>
                </div>
        </template>




        <template id="report_l10nuy_einvoice">
            <t t-call="l10n_uy_einvoice_document.basic_custom_layout">
                <t t-foreach="docs" t-as="doc">
                    <t t-set="lang" t-value="doc.partner_id.lang"/>
                    <t t-call="l10n_uy_einvoice_document.report_l10nuy_einvoice_document" t-lang="lang"/>
                </t>
            </t>
        </template>


        <record id="action_report_l10nuy_einvoice" model="ir.actions.report">
            <field name="name">Invoices l10nuy Focus</field>
            <field name="model">account.move</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">l10n_uy_einvoice_document.report_l10nuy_einvoice</field>
            <field name="report_file">l10n_uy_einvoice_document.report_l10nuy_einvoice</field>
            <field name="print_report_name">(object._get_report_base_filename())</field>
            <field name="attachment"/>
            <field name="binding_model_id" ref="account.model_account_move"/>
            <field name="binding_type">report</field>
            <field name="paperformat_id" ref="paperformat_l10nuy_focus"/>
        </record>


        <template id="basic_custom_layout">
                <t t-call="l10n_uy_einvoice_document.report_layout_custom">
                    <t t-if="not o" t-set="o" t-value="doc"/>
                    <div class="article" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')" t-attf-style="background-image: url({{ 'data:image/png;base64,%s' % o.company_id.layout_background_image.decode('utf-8') if o.company_id.layout_background_image else './l10n_uy_einvoice_document/static/description/background.png'}});padding:50px 25px 0px 25px;">
                        <t t-out="0"/>
                    </div>
                </t>
        </template>


        <template id="report_layout_custom" name="Report layout">&lt;!DOCTYPE html&gt;
            <html t-att-lang="lang and lang.replace('_', '-')"
                  t-att-data-report-margin-top="data_report_margin_top"
                  t-att-data-report-header-spacing="data_report_header_spacing"
                  t-att-data-report-dpi="data_report_dpi"
                  t-att-data-report-landscape="data_report_landscape"
                  t-att-web-base-url="web_base_url">
                <head>
                    <meta charset="utf-8"/>
                    <meta name="viewport" content="initial-scale=1"/>
                    <title><t t-esc="title or 'Odoo Report'"/></title>
                    <!-- Temporary code: only used to maintain CSS for legacy HTML reports (full width...) -->
                    <!-- Should be removed once the reports are fully converted. -->
                    <script type="text/javascript">
                        document.addEventListener('DOMContentLoaded', () => {
                        if (window.self !== window.top) {
                        document.body.classList.add("o_in_iframe", "container-fluid");
                        document.body.classList.remove("container");
                        }
                        });
                    </script>
                </head>
                <body t-att-class="'container' if not full_width else 'container-fluid'" t-att-dir="env['res.lang']._lang_get(lang or env.user.lang).direction or 'ltr'">
                    <div>
                        <main>
                            <t t-out="0"/>
                        </main>
                    </div>
                </body>
            </html>
        </template>


    </data>
</odoo>
